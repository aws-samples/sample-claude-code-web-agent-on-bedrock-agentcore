# Claude Code Web Agent - 用户手册

[English](USER_GUIDE.md) | 简体中文

本手册提供了 Claude Code Web Agent 的部署和使用的详细说明。

## 目录

1. [部署指南](#部署指南)
2. [用户注册和登录](#用户注册和登录)
3. [项目管理](#项目管理)
4. [创建会话与 Agent 对话](#创建会话与-agent-对话)
5. [文件管理和预览](#文件管理和预览)
6. [Git 操作](#git-操作)
7. [终端使用](#终端使用)
8. [断开连接和重新连接](#断开连接和重新连接)

---

## 部署指南

### 前置条件

在部署 Claude Code Web Agent 之前,请确保您具备:

- 已配置适当凭证的 **AWS CLI**
- 已安装 **Docker**(用于构建容器镜像)
- **Node.js 18+** 和 npm
- **jq**(JSON 处理器)
- **GitHub OAuth 应用程序**(用于仓库访问)

### 步骤 1: 配置部署设置

1. 导航到部署目录:
   ```bash
   cd deploy
   ```

2. 复制配置模板:
   ```bash
   cp config.env.template config.env
   ```

3. 编辑 `config.env` 并配置以下内容:
   - **AWS_REGION**: 您的 AWS 区域(例如 `us-west-2`)
   - **GITHUB_OAUTH_CLIENT_ID**: 来自您的 GitHub OAuth 应用
   - **GITHUB_OAUTH_CLIENT_SECRET**: 来自您的 GitHub OAuth 应用
   - **COGNITO_*** (可选): 留空以自动创建新的 Cognito 用户池
   - **AVAILABLE_MODELS**: Web 客户端的模型列表(逗号分隔)
   - **模型配置**: 可选,已提供默认值

### 步骤 2: 构建并推送 Docker 镜像

构建后端容器并推送到 Amazon ECR:

```bash
./deploy/01_build_and_push.sh
```

此脚本将:
- 创建 ECR 仓库
- 构建 ARM64 Docker 镜像(AgentCore 要求)
- 将镜像推送到 ECR

### 步骤 3: 部署 AgentCore 运行时

将后端部署到 Bedrock AgentCore:

```bash
./deploy/02_deploy_agentcore.sh
```

此脚本将:
- 创建或更新 AgentCore 运行时
- 创建 S3 工作空间存储桶
- 设置 Cognito 用户池(如果未提供)
- 创建具有所需权限的 IAM 执行角色
- 配置 GitHub OAuth 提供商
- 将配置导出到 `.agentcore_output`

### 步骤 4: 部署 Amplify 前端

将 React 前端部署到 AWS Amplify:

```bash
./deploy/03_deploy_amplify.sh
```

此脚本将:
- 创建或更新 Amplify 应用
- 构建并部署 React 前端
- 配置环境变量
- 自动更新 OAuth 回调 URL
- 提供 Amplify 应用 URL

### 步骤 5: 更新 GitHub OAuth 应用

部署后,更新您的 GitHub OAuth 应用设置:

1. 访问 https://github.com/settings/developers
2. 选择您的 OAuth 应用
3. 更新 **Authorization callback URL** 为:
   ```
   https://main.YOUR_AMPLIFY_DOMAIN/oauth/callback
   ```

### 快速部署

一次运行所有部署步骤:

```bash
./deploy/deploy_all.sh
```

---

## 用户注册和登录

### 了解认证系统

Claude Code Web Agent 使用 **AWS Cognito** 进行用户认证,提供安全的注册、登录和会话管理。

### 注册新账户

1. **访问应用程序**: 导航到您部署的 Amplify URL(例如 `https://main.YOUR_AMPLIFY_DOMAIN`)

2. **点击 "Sign Up"**: 在登录页面底部点击 "Sign Up" 按钮

3. **填写注册表单**:
   - **用户名**: 选择唯一的用户名(字母、数字和下划线)
   - **邮箱**: 输入有效的电子邮件地址(将用于验证)
   - **密码**: 创建强密码(至少 8 个字符,包括大写、小写、数字和特殊字符)

4. **提交注册**: 点击 "Sign Up" 按钮

5. **邮箱验证**:
   - 检查您的邮箱收件箱以获取验证码
   - 在确认页面输入 6 位数验证码
   - 点击 "Confirm" 激活您的账户

6. **自动登录**: 成功确认后,您将自动登录

### 登录

1. **访问登录页面**: 导航到应用程序 URL

2. **输入凭证**:
   - **用户名或邮箱**: 输入您的用户名或电子邮件地址
   - **密码**: 输入您的密码

3. **点击 "Sign In"**: 点击登录按钮进行身份验证

4. **连接模态框**: 登录后,您将看到 "Connect to Server" 模态框
   - 点击 **"Connect to Server"** 启动后台服务并启用所有功能

### 登录问题排查

- **密码错误**: 仔细检查您的密码并重试
- **邮箱未验证**: 检查您的电子邮件并完成验证
- **账户锁定**: 如果超过登录尝试次数,请联系管理员
- **忘记密码**: 使用密码重置功能(如果已启用)

---

## 项目管理

### 了解项目和工作空间

Claude Code Web Agent 中的 **项目** 是隔离的工作空间,您可以在其中处理不同的代码库。每个项目都有:
- 位于 `/workspace/{项目名称}` 的工作目录
- Git 仓库(可选)
- 会话历史
- 文件结构

### 创建新项目

1. **导航到项目选项卡**: 点击左侧边栏中的文件夹图标(📁)

2. **点击 "Create Project"**: 点击顶部的 "+ Create Project" 按钮

3. **输入项目详细信息**:
   - **项目名称**: 选择描述性名称(字母数字、连字符、下划线)
   - 项目将在 `/workspace/{项目名称}` 中创建

4. **点击 "Create"**: 确认项目创建

5. **自动切换**: 系统将自动切换到您的新项目

### 从 GitHub 导入

1. **导航到项目选项卡**: 点击左侧边栏中的文件夹图标

2. **点击 "Import from GitHub"**: 找到 GitHub 导入按钮

3. **使用 GitHub 进行身份验证**(仅首次):
   - 点击标题(右上角)中的 GitHub 图标
   - 授权应用程序访问您的 GitHub 账户
   - 等待确认(绿色勾选标记)

4. **输入仓库 URL**:
   - **HTTPS URL**: `https://github.com/username/repository.git`
   - **SSH URL**: `git@github.com:username/repository.git`(需要 SSH 密钥设置)
   - **可选**: 指定分支名称(默认为主分支)
   - **可选**: 启用浅克隆以加快克隆速度

5. **点击 "Clone"**: 开始克隆过程

6. **监控进度**: 在控制台中观察克隆进度

7. **自动切换**: 成功克隆后,项目将被激活

### 在项目之间切换

1. **打开项目切换器**:
   - 点击标题中的项目名称(显示当前项目或 "Default Workspace")
   - 或点击侧边栏中的文件夹图标并从列表中选择项目

2. **选择项目**: 点击列表中的任何项目

3. **确认切换**(如果您有活动会话):
   - 警告: 切换将关闭您当前的会话
   - 点击 "OK" 继续

4. **自动备份**: 在切换之前,您当前的项目会自动备份到 S3

5. **项目激活**: 新项目的工作空间已加载并准备使用

### 项目功能

- **自动 S3 备份**: 切换时项目自动同步到 S3
- **隔离会话**: 每个项目都有自己的会话历史
- **工作目录**: 项目有专用的工作目录
- **Git 集成**: 每个项目完整的 git 支持
- **文件浏览器**: 在每个项目中浏览和管理文件

---

## 创建会话与 Agent 对话

### 了解会话

**会话** 表示与 Claude agent 的对话。每个会话维护:
- 对话历史
- Agent 上下文和记忆
- 工具使用历史
- 工作目录上下文

### 创建新会话

1. **导航到会话选项卡**: 点击左侧边栏中的聊天图标(💬)

2. **点击 "New Session"**(或 + 按钮):
   - 如果您没有活动会话,按钮将显示 "Start Session"
   - 如果您有活动会话,它将显示 "Clear Session"

3. **会话初始化**:
   - 生成唯一的会话 ID
   - Agent 使用您的工作目录上下文进行初始化
   - 您将在聊天中看到 "✅ Connected to Claude Agent"

4. **会话信息**: 会话 ID 显示在聊天标题中

### 与 Agent 对话

1. **输入您的消息**: 在底部的输入框中输入您的请求:
   ```
   创建一个读取 CSV 文件并生成摘要报告的 Python 脚本
   ```

2. **发送消息**: 点击发送按钮(➤)或按 Enter 键

3. **Agent 响应**: Agent 将:
   - 实时流式传输其响应
   - 根据需要使用工具(文件操作、终端命令等)
   - 在聊天中显示工具使用(例如 "Using tool: Edit")

4. **查看输出**: 检查 agent 的文本响应和工具输出

### 权限系统

Agent 在执行某些操作时需要权限:

1. **权限请求出现**: 当 agent 需要执行写操作时,您将看到黄色权限框

2. **审查请求**:
   - **工具名称**: 正在使用的工具(例如 "Edit"、"Write")
   - **参数**: 操作的详细信息(文件路径、内容等)
   - **建议的更改**: Agent 想要修改的内容

3. **授予或拒绝权限**:
   - **✓ Allow**: 授予此操作的权限
   - **⚡ Apply Suggestions**: 应用建议的更改并授予权限
   - **✗ Deny**: 拒绝该操作

4. **继续对话**: 在您做出决定后,agent 继续

### 模型选择

您可以在会话期间切换模型:

1. **当前模型**: 显示在聊天标题中(例如 "sonnet-4-5-...")

2. **点击模型名称**: 打开模型选择器下拉菜单

3. **选择模型**: 从可用模型中选择:
   - **Claude Sonnet 4.5**: 最适合复杂推理和编码
   - **Claude Haiku 4.5**: 更快,适合简单任务
   - **Qwen Coder**: 专门用于编码任务

4. **模型切换**: Agent 将为后续消息使用新模型

### 管理会话

**恢复先前的会话**:
1. 导航到会话选项卡
2. 点击会话列表中的任何会话
3. 对话历史将被加载

**清除当前会话**:
1. 在会话选项卡中点击 "Clear Session"
2. 确认操作
3. 创建新会话,丢失当前上下文

**会话持久性**:
- 会话自动保存到磁盘
- 即使在断开连接后也可以恢复会话
- 每个会话文件存储在 `~/.claude/projects/` 中

---

## 文件管理和预览

### 了解文件浏览器

**文件浏览器** 显示您当前项目的文件结构,允许您导航、预览和管理文件。

### 浏览文件

1. **访问文件浏览器**: 点击左侧边栏中的文件图标(📄)

2. **浏览目录**:
   - 点击文件夹名称以展开/折叠它们
   - 当前路径显示在顶部
   - 使用面包屑导航向上导航目录

3. **文件图标**:
   - 📁 文件夹
   - 📄 文件
   - 🔧 配置文件(.json、.yaml、.toml 等)
   - 🐍 Python 文件(.py)
   - 📜 JavaScript 文件(.js、.jsx、.ts、.tsx)

### 预览文件

1. **点击文件**: 点击文件浏览器中的任何文件名

2. **预览面板打开**: 右侧出现预览面板

3. **文件内容显示**:
   - **文本文件**: 显示语法高亮的内容
   - **图像**: 显示图像
   - **大文件**: 显示第一部分,带有 "Load More" 选项

4. **语法高亮**: 自动检测代码文件的语言

5. **关闭预览**: 点击预览标题中的 ✗ 按钮

### 通过 Agent 进行文件操作

您可以要求 agent 执行文件操作:

```
创建一个名为 main.py 的新文件,包含 Hello World 程序
```

```
读取 config.json 的内容并解释每个设置的作用
```

```
修改 utils.py 以向 process_data 函数添加错误处理
```

### 文件刷新

- **自动刷新**: 当您向 agent 发送消息时,文件会自动刷新
- **手动刷新**: Agent 操作后文件浏览器更新
- **实时更新**: Agent 所做的更改立即显示

---

## Git 操作

### 了解 Git 集成

**Git 面板** 提供版本控制功能,允许您查看更改、创建提交和推送到远程仓库。

### 查看 Git 状态

1. **访问 Git 选项卡**: 点击左侧边栏中的 git 分支图标

2. **Git 状态显示**:
   - **当前分支**: 在标题中显示为徽章
   - **暂存文件**: 准备提交的文件(绿色 +)
   - **未暂存文件**: 尚未暂存的修改文件(蓝色 M)
   - **未跟踪文件**: 不在 git 中的新文件(📄)

3. **文件更改图标**:
   - **M**(已修改): 文件已更改
   - **A**(已添加): 新文件已暂存
   - **D**(已删除): 文件已被删除

4. **自动刷新**: 当您切换到 Git 选项卡时,git 状态会刷新

### 查看提交历史

1. **最近提交部分**: 向下滚动以查看最近的提交

2. **提交信息**:
   - **提交哈希**: 短哈希(前 7 个字符)
   - **作者**: 谁进行了提交
   - **日期**: 提交时间
   - **消息**: 提交消息

3. **展开提交**: 点击任何提交以查看更改的文件

4. **文件更改**: 显示该提交中修改了哪些文件

### 创建提交

1. **查看更改**: 检查 "Changes" 部分中的文件

2. **点击 "Commit" 按钮**: 打开提交表单

3. **编写提交消息**:
   - 第一行: 简要摘要(建议最多 50 个字符)
   - 空行(可选)
   - 详细描述(如果需要)

4. **选择文件**(可选):
   - 默认情况下,包括所有更改的文件
   - 取消选中您不想提交的文件
   - 或保留所有选中以提交所有内容

5. **点击 "Create Commit"**: 完成提交

6. **确认**: 您将看到 "✓ Commit created successfully"

### 推送到远程

1. **确保存在提交**: 检查您是否有要推送的本地提交

2. **点击 "Push" 按钮**: 位于最近提交部分

3. **确认推送**: 出现确认对话框

4. **GitHub 身份验证**(如果需要):
   - 如果未经身份验证,系统将提示您使用 GitHub 进行身份验证
   - 遵循 GitHub OAuth 流程

5. **推送进度**: 等待推送完成

6. **成功消息**: "Successfully pushed commits"

### 通过 Agent 进行 Git 操作

您也可以要求 agent 执行 git 操作:

```
显示 git 状态
```

```
创建一个提交消息为 "Add user authentication feature" 的提交
```

```
将我的更改推送到远程仓库
```

### 手动刷新

- **刷新按钮**: 点击 Git 面板标题中的刷新图标(🔄)
- **刷新**: git 状态和提交历史
- **使用场景**: 在外部 git 操作后更新

---

## 终端使用

### 了解集成终端

**终端** 提供在服务器上运行的全功能命令行界面,允许您执行命令、运行脚本并与工作空间交互。

### 打开终端

1. **点击终端图标**: 点击标题(右上角)中的终端图标(⌨️)

2. **终端面板打开**: 终端面板从右侧滑入

3. **初始状态**: 终端在您当前的项目目录中初始化

### 使用终端

1. **运行命令**: 输入任何 shell 命令并按 Enter 键:
   ```bash
   ls -la
   ```
   ```bash
   python script.py
   ```
   ```bash
   npm install
   ```

2. **输出显示**: 命令输出实时显示

3. **颜色支持**: 支持 ANSI 颜色以提高可读性

4. **命令历史**:
   - 按 ↑ 键循环浏览先前的命令
   - 按 ↓ 键在历史中前进

5. **Tab 补全**: Tab 键用于自动补全(如果 shell 支持)

### 终端功能

- **工作目录**: 始终从您当前的项目目录开始
- **环境**: 具有所有系统工具的完整 shell 环境
- **长时间运行的命令**: 支持无限期运行的命令
- **交互式程序**: 可以运行 vim、nano 等交互式程序
- **多行**: 支持多行输入(使用 Shift+Enter)

### 常见用例

**包管理**:
```bash
npm install express
pip install requests
uv add anthropic
```

**运行脚本**:
```bash
python main.py
node server.js
./run_tests.sh
```

**Git 操作**:
```bash
git status
git pull origin main
git log --oneline -10
```

**文件操作**:
```bash
cat config.json
grep -r "TODO" src/
find . -name "*.py"
```

**构建和测试**:
```bash
npm run build
pytest tests/
cargo build --release
```

### 调整终端大小

1. **调整大小手柄**: 将鼠标放在终端面板的左边缘

2. **拖动以调整大小**: 点击并向左或向右拖动以调整宽度

3. **大小限制**: 终端宽度限制在 400px 到 1000px 之间

### 关闭终端

1. **再次点击终端图标**: 关闭终端

2. **或点击 ✗**: 点击终端标题中的关闭按钮

3. **会话持续**: 终端会话在后台保持活动

---

## 断开连接和重新连接

### 了解连接状态

Claude Code Web Agent 有两种连接状态:
- **服务器已连接**: 后台服务运行,可以使用所有功能
- **服务器已断开**: 后台服务已停止,功能有限

### 断开与服务器的连接

断开连接会停止所有后台服务,但保持您的登录状态。

1. **点击断开按钮**: 点击标题中的 ✗ 圆圈图标

2. **确认断开**: 出现确认对话框:
   ```
   Disconnect from server?

   This will stop all background requests and close any active sessions.
   ```

3. **点击 "OK"**: 确认断开操作

4. **断开过程**:
   - 当前 agent 会话已关闭(如果活动)
   - 等待 3 秒以完成待处理的请求
   - 停止 AgentCore 运行时会话
   - 后台服务(健康检查、轮询)已停止

5. **断开模态框出现**: 您将看到带有选项的连接模态框:
   - **Connect to Server**: 重新连接并恢复工作
   - **Force Stop AgentCore**: 紧急停止(如果需要)
   - **Log Out**: 退出应用程序

### 重新连接到服务器

1. **点击 "Connect to Server"**: 在断开模态框上

2. **后台服务启动**:
   - 健康检查轮询恢复
   - 会话轮询恢复
   - API 连接已建立

3. **准备使用**: 现在所有功能都可用

4. **自动恢复**: 保留您之前的项目和设置

### 退出登录

退出登录会停止所有服务并结束您的会话。

1. **点击退出按钮**: 点击标题中的退出图标

2. **确认退出**: 出现确认对话框:
   ```
   Logout?

   This will stop all background requests, close any active sessions, and log you out.
   ```

3. **点击 "OK"**: 确认退出操作

4. **退出过程**:
   - 断开活动 agent 会话
   - 等待 3 秒以完成待处理的请求
   - 停止 AgentCore 运行时会话
   - 从 Cognito 注销

5. **重定向到登录**: 您被重定向到登录页面

### 强制停止 AgentCore(紧急)

如果系统无响应,您可以强制停止:

1. **访问断开模态框**: 首先断开与服务器的连接

2. **点击 "Force Stop AgentCore"**: 模态框中的红色按钮

3. **确认操作**: 这将立即停止运行时会话

4. **使用场景**: 仅在正常断开失败时使用

### 重新连接场景

**断开后**:
- 保留所有设置
- 保留项目选择
- 没有活动会话(必须创建新会话)
- 后台服务重新启动

**退出后**:
- 必须重新登录
- 设置保留在浏览器中
- 保留项目选择
- 没有活动会话

**强制停止后**:
- 必须重新连接到服务器
- 可能需要等待几秒钟以重新启动运行时
- 保留所有状态

### 最佳实践

- **正常工作**: 保持服务器连接
- **长时间休息**: 断开连接以节省资源
- **一天结束**: 为了安全而退出
- **切换用户**: 始终先退出
- **故障排除**: 将强制停止作为最后手段

---

## 提示和最佳实践

### 会话管理

- **创建描述性会话名称**: 使用清晰的命名以便轻松识别
- **恢复旧会话**: 在不丢失上下文的情况下继续之前的工作
- **在开始新任务时清除**: 为不相关的工作重新开始

### 文件组织

- **为不同的仓库使用项目**: 保持代码库分离
- **定期提交**: 使用清晰的消息频繁提交
- **备份到 S3**: 项目切换会自动备份到 S3

### Agent 交互

- **具体**: 向 agent 提供清晰、详细的指令
- **审查权限**: 始终审查 agent 想要更改的内容
- **使用上下文**: 引用文件和先前的对话上下文

### 性能

- **关闭未使用的面板**: 不需要时隐藏预览和终端
- **空闲时断开连接**: 在休息期间节省资源
- **使用适当的模型**: 简单任务使用 Haiku,复杂任务使用 Sonnet

### 安全

- **在共享计算机上退出**: 完成后始终退出
- **审查文件更改**: 在提交之前检查 agent 修改的内容
- **不要共享凭据**: 永远不要共享您的登录凭据

---

## 故障排除

### 无法连接到服务器

- **检查 URL**: 验证 Amplify URL 是否正确
- **检查部署**: 确保 AgentCore 运行时已部署
- **检查日志**: 查看浏览器控制台中的错误

### 会话创建失败

- **服务器已断开**: 首先连接到服务器
- **检查权限**: 确保 IAM 角色配置正确
- **检查 Bedrock 访问**: 在 Bedrock 控制台中验证模型访问

### 文件操作失败

- **检查权限**: 文件系统权限可能受到限制
- **检查磁盘空间**: S3 存储桶可能已满
- **刷新浏览器**: 尝试刷新页面

### Git 操作失败

- **GitHub 身份验证**: 点击 GitHub 图标并进行身份验证
- **检查仓库**: 验证仓库 URL 是否正确
- **检查凭据**: 可能需要重新进行身份验证

### 终端不工作

- **重新加载页面**: 尝试刷新浏览器
- **检查连接**: 确保服务器已连接
- **检查防火墙**: 企业防火墙可能会阻止 WebSocket 连接

---

## 支持和资源

### 文档

- **README.md**: 架构和部署概述
- **WORKSPACE_SYNC.md**: 工作空间管理详细信息
- **后端文档**: `backend/` 目录中的 API 参考

### 获取帮助

- **GitHub Issues**: 报告错误并请求功能
- **AWS 支持**: 就基础设施问题联系 AWS 支持
- **社区**: 加入项目论坛的讨论

### 其他资源

- **AWS Bedrock 文档**: https://docs.aws.amazon.com/bedrock/
- **Claude API 文档**: https://docs.anthropic.com/
- **AWS Amplify 文档**: https://docs.aws.amazon.com/amplify/

---

**版本**: 1.0.0
**最后更新**: 2025-01-13
